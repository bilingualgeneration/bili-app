import{W as p,o as s,q as N,t as C,u as O,v as f,x as y,O as u,y as v,P as c,E as g,F as d,G as h,z as R,R as w,A as U,T as I,B as P,C as _,D as k,H as T,I as E,J as m,L as W,M as A,N as L,Q as G,S as V,U as D,V as M,X as H,Y as F,Z as S,_ as B,$,a0 as x,a1 as Y,a2 as J,a3 as b,a4 as j,a5 as q,a6 as z,a7 as Q,a8 as X}from"./index-0f3b5bf3.js";class i extends p{constructor(){super(),this.lastConfirmationResult=new Map,s().onAuthStateChanged(t=>this.handleAuthStateChange(t))}async applyActionCode(e){const t=s();return N(t,e.oobCode)}async createUserWithEmailAndPassword(e){const t=s(),r=await C(t,e.email,e.password);return this.createSignInResult(r,null)}async confirmPasswordReset(e){const t=s();return O(t,e.oobCode,e.newPassword)}async confirmVerificationCode(e){const{verificationCode:t,verificationId:r}=e,n=this.lastConfirmationResult.get(r);if(!n)throw new Error(i.ERROR_CONFIRMATION_RESULT_MISSING);const a=await n.confirm(t);return this.createSignInResult(a,null)}async deleteUser(){const t=s().currentUser;if(!t)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return f(t)}async getCurrentUser(){const e=s();return{user:this.createUserResult(e.currentUser)}}async getIdToken(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return{token:await t.currentUser.getIdToken(e==null?void 0:e.forceRefresh)||""}}async getRedirectResult(){const e=s(),t=await y(e),r=t?u.credentialFromResult(t):null;return this.createSignInResult(t,r)}async getTenantId(){return{tenantId:s().tenantId}}async isSignInWithEmailLink(e){const t=s();return{isSignInWithEmailLink:v(t,e.emailLink)}}async linkWithApple(e){const t=new u(c.APPLE);this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=u.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithEmailAndPassword(e){const t=g.credential(e.email,e.password),r=await this.linkCurrentUserWithCredential(t);return this.createSignInResult(r,t)}async linkWithEmailLink(e){const t=g.credentialWithLink(e.email,e.emailLink),r=await this.linkCurrentUserWithCredential(t);return this.createSignInResult(r,t)}async linkWithFacebook(e){const t=new d;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=d.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithGameCenter(){throw new Error("Not available on web.")}async linkWithGithub(e){const t=new h;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=h.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithGoogle(e){const t=new R;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=R.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithMicrosoft(e){const t=new u(c.MICROSOFT);this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=u.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithPhoneNumber(e){const r=s().currentUser;if(!r)throw new Error(i.ERROR_NO_USER_SIGNED_IN);if(!e.phoneNumber)throw new Error(i.ERROR_PHONE_NUMBER_MISSING);if(!e.recaptchaVerifier||!(e.recaptchaVerifier instanceof w))throw new Error(i.ERROR_RECAPTCHA_VERIFIER_MISSING);try{const n=await U(r,e.phoneNumber,e.recaptchaVerifier),{verificationId:a}=n;this.lastConfirmationResult.set(a,n);const o={verificationId:a};this.notifyListeners(i.PHONE_CODE_SENT_EVENT,o)}catch(n){const a={message:this.getErrorMessage(n)};this.notifyListeners(i.PHONE_VERIFICATION_FAILED_EVENT,a)}}async linkWithPlayGames(){throw new Error("Not available on web.")}async linkWithTwitter(e){const t=new I;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=I.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithYahoo(e){const t=new u(c.YAHOO);this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e==null?void 0:e.mode),n=u.credentialFromResult(r);return this.createSignInResult(r,n)}async reload(){const t=s().currentUser;if(!t)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return P(t)}async sendEmailVerification(){const t=s().currentUser;if(!t)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return _(t)}async sendPasswordResetEmail(e){const t=s();return k(t,e.email)}async sendSignInLinkToEmail(e){const t=s();return T(t,e.email,e.actionCodeSettings)}async setLanguageCode(e){const t=s();t.languageCode=e.languageCode}async setPersistence(e){const t=s();switch(e.persistence){case E.BrowserLocal:await m(t,X);break;case E.BrowserSession:await m(t,Q);break;case E.IndexedDbLocal:await m(t,z);break;case E.InMemory:await m(t,q);break}}async setTenantId(e){const t=s();t.tenantId=e.tenantId}async signInAnonymously(){const e=s(),t=await W(e);return this.createSignInResult(t,null)}async signInWithApple(e){const t=new u(c.APPLE);this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=u.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithCustomToken(e){const t=s(),r=await A(t,e.token);return this.createSignInResult(r,null)}async signInWithEmailAndPassword(e){const t=s(),r=await L(t,e.email,e.password);return this.createSignInResult(r,null)}async signInWithEmailLink(e){const t=s(),r=await G(t,e.email,e.emailLink);return this.createSignInResult(r,null)}async signInWithFacebook(e){const t=new d;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=d.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithGithub(e){const t=new h;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=h.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithGoogle(e){const t=new R;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=R.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithMicrosoft(e){const t=new u(c.MICROSOFT);this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=u.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithPhoneNumber(e){if(!e.phoneNumber)throw new Error(i.ERROR_PHONE_NUMBER_MISSING);if(!e.recaptchaVerifier||!(e.recaptchaVerifier instanceof w))throw new Error(i.ERROR_RECAPTCHA_VERIFIER_MISSING);const t=s();try{const r=await V(t,e.phoneNumber,e.recaptchaVerifier),{verificationId:n}=r;this.lastConfirmationResult.set(n,r);const a={verificationId:n};this.notifyListeners(i.PHONE_CODE_SENT_EVENT,a)}catch(r){const n={message:this.getErrorMessage(r)};this.notifyListeners(i.PHONE_VERIFICATION_FAILED_EVENT,n)}}async signInWithPlayGames(){throw new Error("Not available on web.")}async signInWithGameCenter(){throw new Error("Not available on web.")}async signInWithTwitter(e){const t=new I;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=I.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithYahoo(e){const t=new u(c.YAHOO);this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e==null?void 0:e.mode),n=u.credentialFromResult(r);return this.createSignInResult(r,n)}async signOut(){await s().signOut()}async unlink(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);const r=await D(t.currentUser,e.providerId);return{user:this.createUserResult(r)}}async updateEmail(e){const r=s().currentUser;if(!r)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return M(r,e.newEmail)}async updatePassword(e){const r=s().currentUser;if(!r)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return H(r,e.newPassword)}async updateProfile(e){const r=s().currentUser;if(!r)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return F(r,e)}async useAppLanguage(){s().useDeviceLanguage()}async useEmulator(e){const t=s(),r=e.port||9099,n=e.scheme||"http";e.host.includes("://")?S(t,"".concat(e.host,":").concat(r)):S(t,"".concat(n,"://").concat(e.host,":").concat(r))}handleAuthStateChange(e){const r={user:this.createUserResult(e)};this.notifyListeners(i.AUTH_STATE_CHANGE_EVENT,r)}applySignInOptions(e,t){if(e.customParameters){const r={};e.customParameters.map(n=>{r[n.key]=n.value}),t.setCustomParameters(r)}if(e.scopes)for(const r of e.scopes)t.addScope(r)}signInWithPopupOrRedirect(e,t){const r=s();return t==="redirect"?B(r,e):$(r,e)}linkCurrentUserWithPopupOrRedirect(e,t){const r=s();if(!r.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return t==="redirect"?x(r.currentUser,e):Y(r.currentUser,e)}linkCurrentUserWithCredential(e){const t=s();if(!t.currentUser)throw new Error(i.ERROR_NO_USER_SIGNED_IN);return J(t.currentUser,e)}createSignInResult(e,t){const r=this.createUserResult((e==null?void 0:e.user)||null),n=this.createCredentialResult(t),a=this.createAdditionalUserInfoResult(e);return{user:r,credential:n,additionalUserInfo:a}}createCredentialResult(e){if(!e)return null;const t={providerId:e.providerId};return e instanceof b&&(t.accessToken=e.accessToken,t.idToken=e.idToken,t.secret=e.secret),t}createUserResult(e){return e?{displayName:e.displayName,email:e.email,emailVerified:e.emailVerified,isAnonymous:e.isAnonymous,metadata:this.createUserMetadataResult(e.metadata),phoneNumber:e.phoneNumber,photoUrl:e.photoURL,providerData:this.createUserProviderDataResult(e.providerData),providerId:e.providerId,tenantId:e.tenantId,uid:e.uid}:null}createUserMetadataResult(e){const t={};return e.creationTime&&(t.creationTime=Date.parse(e.creationTime)),e.lastSignInTime&&(t.lastSignInTime=Date.parse(e.lastSignInTime)),t}createUserProviderDataResult(e){return e.map(t=>({displayName:t.displayName,email:t.email,phoneNumber:t.phoneNumber,photoUrl:t.photoURL,providerId:t.providerId,uid:t.uid}))}createAdditionalUserInfoResult(e){if(!e)return null;const t=j(e);if(!t)return null;const{isNewUser:r,profile:n,providerId:a,username:o}=t,l={isNewUser:r};return a!==null&&(l.providerId=a),n!==null&&(l.profile=n),o!=null&&(l.username=o),l}getErrorMessage(e){return e instanceof Object&&"message"in e&&typeof e.message=="string"?e.message:JSON.stringify(e)}}i.AUTH_STATE_CHANGE_EVENT="authStateChange";i.PHONE_CODE_SENT_EVENT="phoneCodeSent";i.PHONE_VERIFICATION_FAILED_EVENT="phoneVerificationFailed";i.ERROR_NO_USER_SIGNED_IN="No user is signed in.";i.ERROR_PHONE_NUMBER_MISSING="phoneNumber must be provided.";i.ERROR_RECAPTCHA_VERIFIER_MISSING="recaptchaVerifier must be provided and must be an instance of RecaptchaVerifier.";i.ERROR_CONFIRMATION_RESULT_MISSING="No confirmation result with this verification id was found.";export{i as FirebaseAuthenticationWeb};
